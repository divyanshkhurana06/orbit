<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orbit - Your world, perfectly organized</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Load OGL synchronously first -->
    <script src="https://unpkg.com/ogl@1.0.3/dist/ogl.umd.js"></script>
    <script>
        console.log('✅ OGL loaded successfully');
        window.OGLReady = true;
    </script>
    <script src="./circular-gallery-standalone.js"></script>
    <script>
        console.log('✅ Circular gallery script loaded');
    </script>
    <!-- Load application data -->
    <script src="./src/data/app-data.js"></script>
    
    <!-- Load Leaflet for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Load Babel before the React code -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        console.log('✅ Babel loaded, ready to compile React code');
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #10b981;
            --background: #0a0e1a;
            --background-light: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --text: #f8fafc;
            --text-secondary: #94a3b8;
            --accent: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(245, 158, 11, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles with Glass Morphism */
        .header {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 32px;
            font-weight: 800;
            color: var(--text);
            letter-spacing: -0.5px;
        }

        .logo i {
            color: var(--primary);
            animation: rotate 20s linear infinite;
            filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.6));
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .tagline {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 400;
            margin-top: 4px;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .btn:hover::before {
            transform: translateX(100%);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.6);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(51, 65, 85, 0.8);
            backdrop-filter: blur(10px);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(51, 65, 85, 1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        /* WebGL Gallery Container */
        .webgl-gallery-container {
            width: 100%;
            height: 600px;
            margin: 40px 0;
            border-radius: 20px;
            overflow: hidden;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .circular-gallery {
            width: 100%;
            height: 600px;
            min-height: 600px;
            position: relative;
            cursor: grab;
            overflow: hidden;
        }

        .circular-gallery:active {
            cursor: grabbing;
        }

        .circular-gallery canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Section Styles */
        .groups-section {
            margin-bottom: 50px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(135deg, var(--text), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-title i {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Grid Layout for Groups */
        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .group-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            padding: 28px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .group-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            opacity: 0;
            transition: opacity 0.4s;
        }

        .group-card:hover::before {
            opacity: 1;
        }

        .group-card:hover {
            border-color: var(--primary);
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
        }

        .group-icon {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
            transition: transform 0.4s;
        }

        .group-card:hover .group-icon {
            transform: rotate(360deg) scale(1.1);
        }

        .group-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .group-members {
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Circle Detail View */
        .circle-detail {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .circle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .circle-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }

        .circle-tabs::-webkit-scrollbar {
            height: 6px;
        }

        .circle-tabs::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .circle-tab {
            padding: 14px 28px;
            background: rgba(51, 65, 85, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            position: relative;
        }

        .circle-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%) scaleX(0);
            width: 60%;
            height: 3px;
            background: var(--primary);
            border-radius: 10px 10px 0 0;
            transition: transform 0.3s;
        }

        .circle-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .circle-tab.active::after {
            transform: translateX(-50%) scaleX(1);
        }

        .circle-tab:hover {
            background: rgba(59, 130, 246, 0.8);
            transform: translateY(-2px);
        }

        /* Stack Gallery */
        .stack-gallery {
            position: relative;
            height: 450px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
        }

        .stack-container {
            position: relative;
            width: 100%;
            max-width: 550px;
            height: 100%;
            perspective: 1000px;
        }

        .stack-item {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: grab;
            background: linear-gradient(135deg, var(--surface), var(--surface-light));
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stack-item:active {
            cursor: grabbing;
        }

        .stack-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .stack-item.placeholder {
            font-size: 80px;
            color: var(--text-secondary);
            flex-direction: column;
            gap: 20px;
        }

        .stack-controls {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 30px;
        }

        /* Map Section */
        .map-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        #map {
            height: 450px;
            border-radius: 16px;
            margin-top: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* Payment Section */
        .payment-section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.4s both;
        }

        .payment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .payment-card {
            background: rgba(51, 65, 85, 0.6);
            padding: 24px;
            border-radius: 16px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s;
        }

        .payment-card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.3);
        }

        .payment-card h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            color: var(--accent);
            font-size: 18px;
        }

        .payment-input {
            width: 100%;
            padding: 14px;
            background: rgba(10, 14, 26, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text);
            margin: 10px 0;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
        }

        .payment-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }

        /* SDK Badges */
        .sdk-badges {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .sdk-badge {
            padding: 10px 20px;
            background: rgba(51, 65, 85, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 2px solid;
            transition: all 0.3s;
        }

        .sdk-badge:hover {
            transform: translateY(-2px) scale(1.05);
        }

        .sdk-badge.yellow {
            border-color: #f59e0b;
            color: #f59e0b;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
        }

        .sdk-badge.avail {
            border-color: #10b981;
            color: #10b981;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }

        .sdk-badge.blockscout {
            border-color: #3b82f6;
            color: #3b82f6;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
        }

        /* Posts Feed */
        .posts-feed {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .post-card {
            background: rgba(51, 65, 85, 0.6);
            backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 16px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .post-card:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 14px;
        }

        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .post-actions {
            display: flex;
            gap: 20px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .post-action:hover {
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* AI Summary */
        .ai-summary {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.2), rgba(59, 130, 246, 0.2));
            backdrop-filter: blur(20px);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .ai-summary h3 {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 14px;
            font-size: 18px;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(30px);
            padding: 40px;
            border-radius: 24px;
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .close-btn {
            float: right;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.05);
        }

        .close-btn:hover {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
            transform: rotate(90deg);
        }

        .view-toggle {
            display: flex;
            gap: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                padding: 20px;
            }

            .nav-buttons {
                width: 100%;
                justify-content: center;
            }

            .groups-grid {
                grid-template-columns: 1fr;
            }

            .webgl-gallery-container {
                height: 400px;
            }

            .section-title {
                font-size: 24px;
            }

            .payment-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Load data from AppData (no hardcoded values)
        const dataCircles = window.AppData?.circles || [];
        const dataPosts = window.AppData?.posts || [];

        // Web3 Wallet Connection Utility
        const WalletConnection = {
            async connectWallet() {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                        const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                        console.log('✅ Wallet connected:', accounts[0]);
                        return { address: accounts[0], chainId };
                    } catch (error) {
                        console.error('Wallet connection failed:', error);
                        // Fallback to demo mode
                        return { 
                            address: window.AppData.generateWalletAddress(), 
                            chainId: '0x1',
                            isDemo: true 
                        };
                    }
                } else {
                    console.log('⚠️ MetaMask not detected, using demo mode');
                    return { 
                        address: window.AppData.generateWalletAddress(), 
                        chainId: '0x1',
                        isDemo: true 
                    };
                }
            },
            
            async getBalance(address) {
                if (typeof window.ethereum !== 'undefined' && !address.isDemo) {
                    try {
                        const balance = await window.ethereum.request({
                            method: 'eth_getBalance',
                            params: [address, 'latest']
                        });
                        return parseInt(balance, 16) / 1e18;
                    } catch (error) {
                        console.error('Balance fetch failed:', error);
                        return 1.5; // Demo balance
                    }
                } else {
                    return 1.5; // Demo balance
                }
            }
        };

        // Page Components (inline for Babel transformation)
        
        // Home Page Component
        function HomePage({ onNavigate, userData }) {
            const [isVisible, setIsVisible] = useState(false);
            
            useEffect(() => {
                setIsVisible(true);
            }, []);

            return (
                <div className="home-page" style={{
                    minHeight: '100vh',
                    display: 'flex',
                    flexDirection: 'column',
                    animation: 'fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1)'
                }}>
                    <div className="hero-section" style={{
                        flex: 1,
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        textAlign: 'center',
                        padding: '60px 20px'
                    }}>
                        <div style={{ position: 'relative', zIndex: 1, maxWidth: '800px' }}>
                            <div style={{ fontSize: '80px', marginBottom: '20px' }}>🌐</div>
                            <h1 style={{
                                fontSize: 'clamp(48px, 8vw, 72px)',
                                fontWeight: 900,
                                marginBottom: '20px',
                                background: 'linear-gradient(135deg, #fff 0%, #a0c4ff 100%)',
                                WebkitBackgroundClip: 'text',
                                WebkitTextFillColor: 'transparent'
                            }}>
                                Welcome to Orbit
                            </h1>
                            <p style={{
                                fontSize: 'clamp(18px, 3vw, 24px)',
                                color: 'var(--text-secondary)',
                                marginBottom: '40px',
                                lineHeight: 1.6
                            }}>
                                Your world, perfectly organized. Create groups, manage circles, and collaborate seamlessly.
                            </p>
                            <div style={{ display: 'flex', gap: '20px', justifyContent: 'center', flexWrap: 'wrap' }}>
                                <button 
                                    className="btn btn-primary"
                                    onClick={() => onNavigate('groups')}
                                    style={{ fontSize: '18px', padding: '16px 40px' }}
                                >
                                    <i className="fas fa-rocket"></i> Explore Groups
                                </button>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => onNavigate('create')}
                                    style={{ fontSize: '18px', padding: '16px 40px' }}
                                >
                                    <i className="fas fa-plus-circle"></i> Create Group
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Groups Page Component  
        function GroupsPage({ groups, onGroupClick, onCreateClick }) {
            const [galleryView, setGalleryView] = useState('webgl');
            const [searchQuery, setSearchQuery] = useState('');

            const filteredGroups = groups.filter(group => 
                group.name.toLowerCase().includes(searchQuery.toLowerCase())
            );

            return (
                <div className="groups-page" style={{ minHeight: '100vh', paddingBottom: '60px' }}>
                    <div style={{ padding: '40px 30px', borderBottom: '1px solid rgba(255, 255, 255, 0.1)' }}>
                        <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
                            <h1 style={{ fontSize: '36px', fontWeight: 900, marginBottom: '20px' }}>
                                <i className="fas fa-globe"></i> Your Groups
                            </h1>
                            <div style={{ display: 'flex', gap: '12px', marginTop: '20px', flexWrap: 'wrap' }}>
                                <input
                                    type="text"
                                    placeholder="Search groups..."
                                    value={searchQuery}
                                    onChange={(e) => setSearchQuery(e.target.value)}
                                    style={{
                                        padding: '12px 16px',
                                        borderRadius: '12px',
                                        border: '1px solid rgba(255, 255, 255, 0.1)',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        color: 'white',
                                        width: '250px'
                                    }}
                                />
                                <button 
                                    className={`btn ${galleryView === 'webgl' ? 'btn-primary' : 'btn-secondary'}`}
                                    onClick={() => setGalleryView('webgl')}
                                >
                                    <i className="fas fa-circle-notch"></i> Gallery
                                </button>
                                <button 
                                    className={`btn ${galleryView === 'grid' ? 'btn-primary' : 'btn-secondary'}`}
                                    onClick={() => setGalleryView('grid')}
                                >
                                    <i className="fas fa-th"></i> Grid
                                </button>
                                <button 
                                    className="btn btn-primary"
                                    onClick={onCreateClick}
                                >
                                    <i className="fas fa-plus"></i> New Group
                                </button>
                            </div>
                        </div>
                    </div>
                    <div style={{ maxWidth: '1400px', margin: '40px auto', padding: '0 30px' }}>
                        {filteredGroups.length === 0 ? (
                            <div style={{ textAlign: 'center', padding: '100px 20px' }}>
                                <div style={{ fontSize: '80px', marginBottom: '20px' }}>🔍</div>
                                <h2>No groups found</h2>
                                <p style={{ color: 'var(--text-secondary)', marginTop: '16px' }}>
                                    Get started by creating your first group!
                                </p>
                                <button className="btn btn-primary" onClick={onCreateClick} style={{ marginTop: '20px' }}>
                                    <i className="fas fa-plus"></i> Create Your First Group
                                </button>
                            </div>
                        ) : galleryView === 'webgl' ? (
                            <div style={{ 
                                height: '600px', 
                                width: '100%', 
                                position: 'relative',
                                marginBottom: '40px'
                            }}>
                                <CircularGallery items={filteredGroups} onItemClick={onGroupClick} />
                            </div>
                        ) : (
                            <div className="groups-grid">
                                {filteredGroups.map(group => (
                                    <div key={group.id} className="group-card" onClick={() => onGroupClick(group)}>
                                        <div className="group-icon" style={{ background: group.color }}>
                                            {group.icon}
                                        </div>
                                        <div className="group-name">{group.name}</div>
                                        <div className="group-stats">
                                            <span><i className="fas fa-users"></i> {group.members}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Create Group Page Component
        function CreateGroupPage({ onCreate, onCancel }) {
            const [formData, setFormData] = useState({
                name: '',
                icon: '🌟',
                description: '',
                color: '#10b981',
                image: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.name.trim()) {
                    alert('Please enter a group name');
                    return;
                }
                onCreate(formData);
            };

            const availableIcons = window.AppData?.groupIcons || ['✈️', '💻', '🎓', '💪', '🍕', '🚀', '🎮', '🎨', '📚', '🏃', '🎵', '🎬', '⚽', '🏋️', '🧘', '🍜', '☕', '🏖️', '🏔️', '🌟'];
            const availableColors = window.AppData?.groupColors || ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#ec4899', '#14b8a6', '#f97316', '#6366f1'];

            return (
                <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '40px 20px' }}>
                    <div style={{
                        width: '100%',
                        maxWidth: '800px',
                        background: 'rgba(30, 41, 59, 0.8)',
                        backdropFilter: 'blur(20px)',
                        borderRadius: '24px',
                        padding: '50px',
                        boxShadow: '0 20px 60px rgba(0,0,0,0.3)'
                    }}>
                        <div style={{ textAlign: 'center', marginBottom: '40px' }}>
                            <div 
                                style={{ 
                                    fontSize: '80px', 
                                    marginBottom: '16px',
                                    background: formData.color,
                                    width: '120px',
                                    height: '120px',
                                    borderRadius: '24px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    margin: '0 auto 20px',
                                    animation: 'float 3s ease-in-out infinite'
                                }}
                            >
                                {formData.icon}
                            </div>
                            <h1 style={{ fontSize: '36px', fontWeight: 900 }}>Create New Group</h1>
                            <p style={{ color: 'var(--text-secondary)', marginTop: '8px' }}>
                                Customize your group and start collaborating
                            </p>
                        </div>
                        <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                            <div>
                                <label style={{ display: 'block', marginBottom: '8px', fontWeight: 600, fontSize: '14px' }}>
                                    Group Name *
                                </label>
                                <input 
                                    type="text"
                                    placeholder="Enter group name..."
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    style={{ 
                                        width: '100%', 
                                        padding: '14px 16px', 
                                        borderRadius: '12px', 
                                        border: '1px solid rgba(255,255,255,0.1)',
                                        background: 'rgba(255,255,255,0.05)',
                                        color: 'white',
                                        fontSize: '16px'
                                    }}
                                    required
                                />
                            </div>
                            
                            <div>
                                <label style={{ display: 'block', marginBottom: '8px', fontWeight: 600, fontSize: '14px' }}>
                                    Description
                                </label>
                                <textarea 
                                    placeholder="What's this group about?"
                                    value={formData.description}
                                    onChange={(e) => setFormData({...formData, description: e.target.value})}
                                    style={{ 
                                        width: '100%', 
                                        padding: '14px 16px', 
                                        borderRadius: '12px', 
                                        border: '1px solid rgba(255,255,255,0.1)',
                                        background: 'rgba(255,255,255,0.05)',
                                        color: 'white',
                                        fontSize: '16px',
                                        minHeight: '100px',
                                        resize: 'vertical',
                                        fontFamily: 'inherit'
                                    }}
                                />
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '12px', fontWeight: 600, fontSize: '14px' }}>
                                    Choose Icon
                                </label>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(56px, 1fr))', gap: '8px' }}>
                                    {availableIcons.map(icon => (
                                        <button
                                            key={icon}
                                            type="button"
                                            onClick={() => setFormData({...formData, icon})}
                                            style={{
                                                width: '56px',
                                                height: '56px',
                                                fontSize: '28px',
                                                border: formData.icon === icon ? '3px solid #3b82f6' : '1px solid rgba(255,255,255,0.1)',
                                                borderRadius: '12px',
                                                background: formData.icon === icon ? 'rgba(59, 130, 246, 0.2)' : 'rgba(255,255,255,0.05)',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s',
                                                transform: formData.icon === icon ? 'scale(1.1)' : 'scale(1)'
                                            }}
                                        >
                                            {icon}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '12px', fontWeight: 600, fontSize: '14px' }}>
                                    Choose Color
                                </label>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(56px, 1fr))', gap: '8px' }}>
                                    {availableColors.map(color => (
                                        <button
                                            key={color}
                                            type="button"
                                            onClick={() => setFormData({...formData, color})}
                                            style={{
                                                width: '56px',
                                                height: '56px',
                                                background: color,
                                                border: formData.color === color ? '4px solid white' : '2px solid rgba(255,255,255,0.2)',
                                                borderRadius: '12px',
                                                cursor: 'pointer',
                                                transition: 'all 0.2s',
                                                transform: formData.color === color ? 'scale(1.1)' : 'scale(1)',
                                                boxShadow: formData.color === color ? '0 4px 20px rgba(0,0,0,0.3)' : 'none'
                                            }}
                                        />
                                    ))}
                                </div>
                            </div>

                            <div>
                                <label style={{ display: 'block', marginBottom: '8px', fontWeight: 600, fontSize: '14px' }}>
                                    Cover Image URL (optional)
                                </label>
                                <input 
                                    type="url"
                                    placeholder="https://..."
                                    value={formData.image}
                                    onChange={(e) => setFormData({...formData, image: e.target.value})}
                                    style={{ 
                                        width: '100%', 
                                        padding: '14px 16px', 
                                        borderRadius: '12px', 
                                        border: '1px solid rgba(255,255,255,0.1)',
                                        background: 'rgba(255,255,255,0.05)',
                                        color: 'white',
                                        fontSize: '16px'
                                    }}
                                />
                                <p style={{ fontSize: '12px', color: 'var(--text-secondary)', marginTop: '6px' }}>
                                    Leave blank for a random image
                                </p>
                            </div>

                            <div style={{ display: 'flex', gap: '16px', marginTop: '16px' }}>
                                <button type="submit" className="btn btn-primary" style={{ flex: 1, padding: '16px', fontSize: '16px', fontWeight: 600 }}>
                                    <i className="fas fa-check"></i> Create Group
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={onCancel} style={{ flex: 1, padding: '16px', fontSize: '16px', fontWeight: 600 }}>
                                    <i className="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Group Detail Page Component with Web3 Integration
        function GroupDetailPage({ group, circles, posts, onBack }) {
            const [walletAddress, setWalletAddress] = useState(null);
            const [showInviteModal, setShowInviteModal] = useState(false);
            const [showLocationMap, setShowLocationMap] = useState(false);
            const [showPhotoShare, setShowPhotoShare] = useState(false);
            const [showPaymentModal, setShowPaymentModal] = useState(false);
            const [members, setMembers] = useState(window.AppData?.memberLocations || []);
            const [photos, setPhotos] = useState([]);
            const mapRef = useRef(null);
            const mapInstance = useRef(null);

            if (!group) return null;

            // Generate shareable invite link
            const generateInviteLink = () => {
                const baseUrl = window.location.origin + window.location.pathname;
                const inviteLink = `${baseUrl}?join=${group.id}&name=${encodeURIComponent(group.name)}`;
                return inviteLink;
            };

            // Copy invite link to clipboard
            const copyInviteLink = async () => {
                const link = generateInviteLink();
                try {
                    await navigator.clipboard.writeText(link);
                    alert('Invite link copied to clipboard! 🎉');
                } catch (err) {
                    prompt('Copy this invite link:', link);
                }
            };

            // Connect wallet
            const handleConnectWallet = async () => {
                const wallet = await WalletConnection.connectWallet();
                setWalletAddress(wallet.address);
                console.log('Wallet connected:', wallet);
            };

            // Initialize location map
            useEffect(() => {
                if (showLocationMap && mapRef.current && !mapInstance.current) {
                    // Initialize Leaflet map
                    mapInstance.current = L.map(mapRef.current).setView([40.7128, -74.0060], 4);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(mapInstance.current);

                    // Add member markers
                    members.forEach(member => {
                        const marker = L.marker([member.lat, member.lng])
                            .addTo(mapInstance.current)
                            .bindPopup(`
                                <div style="text-align: center;">
                                    <div style="font-size: 32px;">${member.avatar}</div>
                                    <div style="font-weight: 600; margin-top: 8px;">${member.name}</div>
                                    <div style="font-size: 12px; color: #666;">${member.location}</div>
                                </div>
                            `);
                    });
                }

                return () => {
                    if (mapInstance.current) {
                        mapInstance.current.remove();
                        mapInstance.current = null;
                    }
                };
            }, [showLocationMap, members]);

            // Handle photo upload
            const handlePhotoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setPhotos([...photos, {
                            id: Date.now(),
                            url: e.target.result,
                            uploader: walletAddress || 'Anonymous',
                            timestamp: new Date().toISOString()
                        }]);
                    };
                    reader.readAsDataURL(file);
                }
            };
            
            return (
                <div style={{ minHeight: '100vh', paddingBottom: '60px' }}>
                    <div style={{ padding: '20px 30px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '12px' }}>
                        <button className="btn btn-secondary" onClick={onBack}>
                            <i className="fas fa-arrow-left"></i> Back
                        </button>
                        <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
                            {!walletAddress ? (
                                <button className="btn btn-primary" onClick={handleConnectWallet}>
                                    <i className="fas fa-wallet"></i> Connect Wallet
                                </button>
                            ) : (
                                <div style={{ 
                                    padding: '10px 16px', 
                                    background: 'rgba(16, 185, 129, 0.2)', 
                                    borderRadius: '12px',
                                    fontSize: '14px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}>
                                    <i className="fas fa-check-circle" style={{ color: '#10b981' }}></i>
                                    {walletAddress.slice(0, 6)}...{walletAddress.slice(-4)}
                                </div>
                            )}
                            <button className="btn btn-primary" onClick={() => setShowInviteModal(true)}>
                                <i className="fas fa-user-plus"></i> Invite
                            </button>
                        </div>
                    </div>
                    
                    {/* Group Header */}
                    <div style={{
                        backgroundImage: `linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.8)), url(${group.image})`,
                        backgroundSize: 'cover',
                        backgroundPosition: 'center',
                        padding: '80px 30px',
                        textAlign: 'center'
                    }}>
                        <div style={{ fontSize: '80px', marginBottom: '16px' }}>{group.icon}</div>
                        <h1 style={{ fontSize: '48px', fontWeight: 900 }}>{group.name}</h1>
                        <p style={{ fontSize: '18px', color: 'rgba(255,255,255,0.8)', marginTop: '12px' }}>
                            {group.description}
                        </p>
                        <div style={{ display: 'flex', gap: '30px', justifyContent: 'center', marginTop: '30px', flexWrap: 'wrap' }}>
                            <div>
                                <div style={{ fontSize: '32px', fontWeight: 900 }}>{group.members}</div>
                                <div style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Members</div>
                            </div>
                            <div>
                                <div style={{ fontSize: '32px', fontWeight: 900 }}>{circles.length}</div>
                                <div style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Circles</div>
                            </div>
                            <div>
                                <div style={{ fontSize: '32px', fontWeight: 900 }}>$0</div>
                                <div style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>Pool Balance</div>
                            </div>
                        </div>
                    </div>

                    {/* SDK Integration Badges */}
                    <div style={{ maxWidth: '1200px', margin: '40px auto', padding: '0 30px' }}>
                        <div style={{ 
                            display: 'grid', 
                            gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', 
                            gap: '16px',
                            marginBottom: '40px'
                        }}>
                            <div className="sdk-badge yellow" style={{ padding: '20px', borderRadius: '16px', cursor: 'pointer' }}
                                onClick={() => setShowPaymentModal(true)}>
                                <i className="fas fa-bolt" style={{ fontSize: '24px', marginBottom: '8px' }}></i>
                                <div style={{ fontWeight: 600 }}>Yellow Network</div>
                                <div style={{ fontSize: '13px', opacity: 0.8 }}>Instant payments & tipping</div>
                            </div>
                            <div className="sdk-badge avail" style={{ padding: '20px', borderRadius: '16px', cursor: 'pointer' }}
                                onClick={() => setShowPaymentModal(true)}>
                                <i className="fas fa-link" style={{ fontSize: '24px', marginBottom: '8px' }}></i>
                                <div style={{ fontWeight: 600 }}>Avail Nexus</div>
                                <div style={{ fontSize: '13px', opacity: 0.8 }}>Cross-chain pooling</div>
                            </div>
                            <div className="sdk-badge blockscout" style={{ padding: '20px', borderRadius: '16px' }}>
                                <i className="fas fa-brain" style={{ fontSize: '24px', marginBottom: '8px' }}></i>
                                <div style={{ fontWeight: 600 }}>Blockscout AI</div>
                                <div style={{ fontSize: '13px', opacity: 0.8 }}>Smart analytics</div>
                            </div>
                        </div>

                        {/* Action Buttons */}
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px', marginBottom: '40px' }}>
                            <button className="btn btn-primary" onClick={() => setShowLocationMap(!showLocationMap)} style={{ padding: '16px' }}>
                                <i className="fas fa-map-marked-alt"></i> {showLocationMap ? 'Hide' : 'Show'} Member Locations
                            </button>
                            <button className="btn btn-primary" onClick={() => setShowPhotoShare(!showPhotoShare)} style={{ padding: '16px' }}>
                                <i className="fas fa-images"></i> Share Photos
                            </button>
                            <button className="btn btn-primary" onClick={() => setShowPaymentModal(true)} style={{ padding: '16px' }}>
                                <i className="fas fa-coins"></i> Split Payment
                            </button>
                        </div>

                        {/* Member Location Map */}
                        {showLocationMap && (
                            <div style={{ 
                                background: 'rgba(30, 41, 59, 0.6)',
                                borderRadius: '24px',
                                padding: '30px',
                                marginBottom: '40px'
                            }}>
                                <h3 style={{ fontSize: '24px', marginBottom: '20px', display: 'flex', alignItems: 'center', gap: '12px' }}>
                                    <i className="fas fa-map-marked-alt"></i>
                                    Member Locations
                                </h3>
                                <div ref={mapRef} style={{ height: '400px', borderRadius: '16px', overflow: 'hidden' }}></div>
                            </div>
                        )}

                        {/* Photo Sharing Section */}
                        {showPhotoShare && (
                            <div style={{ 
                                background: 'rgba(30, 41, 59, 0.6)',
                                borderRadius: '24px',
                                padding: '30px',
                                marginBottom: '40px'
                            }}>
                                <h3 style={{ fontSize: '24px', marginBottom: '20px', display: 'flex', alignItems: 'center', gap: '12px' }}>
                                    <i className="fas fa-images"></i>
                                    Shared Photos
                                </h3>
                                <div style={{ marginBottom: '20px' }}>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={handlePhotoUpload}
                                        style={{ display: 'none' }}
                                        id="photo-upload"
                                    />
                                    <label htmlFor="photo-upload" className="btn btn-primary" style={{ display: 'inline-block', cursor: 'pointer' }}>
                                        <i className="fas fa-upload"></i> Upload Photo
                                    </label>
                                </div>
                                <div style={{ 
                                    display: 'grid', 
                                    gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', 
                                    gap: '16px' 
                                }}>
                                    {photos.map(photo => (
                                        <div key={photo.id} style={{
                                            borderRadius: '12px',
                                            overflow: 'hidden',
                                            background: 'rgba(255,255,255,0.05)',
                                            aspectRatio: '1'
                                        }}>
                                            <img src={photo.url} alt="Shared" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                        </div>
                                    ))}
                                    {photos.length === 0 && (
                                        <div style={{ textAlign: 'center', padding: '40px', gridColumn: '1 / -1', color: 'var(--text-secondary)' }}>
                                            No photos yet. Upload the first one!
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Circles Section */}
                        <h2 style={{ fontSize: '28px', marginBottom: '20px', display: 'flex', alignItems: 'center', gap: '12px' }}>
                            <i className="fas fa-circle-notch"></i>
                            Circles
                        </h2>
                        <div className="circles-grid">
                            {circles.map(circle => (
                                <div key={circle.id} className="circle-card">
                                    <div style={{ fontSize: '32px' }}>{circle.icon}</div>
                                    <div>{circle.name}</div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Invite Modal */}
                    {showInviteModal && (
                        <div className="modal" onClick={() => setShowInviteModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '500px' }}>
                                <span className="close-btn" onClick={() => setShowInviteModal(false)}>&times;</span>
                                <h2 style={{ fontSize: '28px', fontWeight: 800, marginBottom: '20px', textAlign: 'center' }}>
                                    <i className="fas fa-user-plus"></i> Invite Members
                                </h2>
                                <p style={{ color: 'var(--text-secondary)', marginBottom: '20px', textAlign: 'center' }}>
                                    Share this link with people you want to invite to {group.name}
                                </p>
                                <div style={{ 
                                    padding: '16px', 
                                    background: 'rgba(255,255,255,0.05)', 
                                    borderRadius: '12px',
                                    marginBottom: '20px',
                                    wordBreak: 'break-all',
                                    fontSize: '14px',
                                    fontFamily: 'monospace'
                                }}>
                                    {generateInviteLink()}
                                </div>
                                <button className="btn btn-primary" onClick={copyInviteLink} style={{ width: '100%' }}>
                                    <i className="fas fa-copy"></i> Copy Invite Link
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Payment Modal */}
                    {showPaymentModal && (
                        <div className="modal" onClick={() => setShowPaymentModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <span className="close-btn" onClick={() => setShowPaymentModal(false)}>&times;</span>
                                <h2 style={{ fontSize: '28px', fontWeight: 800, marginBottom: '10px' }}>
                                    <i className="fas fa-coins"></i> Payment Features
                                </h2>
                                <p style={{ color: 'var(--text-secondary)', marginBottom: '30px' }}>
                                    Powered by Yellow, Avail, and Blockscout
                                </p>
                                <div className="payment-grid">
                                    <div className="payment-card">
                                        <h3><i className="fas fa-bolt"></i> Yellow - Instant Pay</h3>
                                        <p style={{ fontSize: '14px', marginBottom: '16px' }}>Send instant, gasless payments</p>
                                        <input type="number" className="payment-input" placeholder="Amount (USDC)" />
                                        <button className="btn btn-primary" style={{ width: '100%', marginTop: '12px' }}>
                                            Send Payment
                                        </button>
                                    </div>
                                    <div className="payment-card">
                                        <h3><i className="fas fa-users"></i> Split Payment</h3>
                                        <p style={{ fontSize: '14px', marginBottom: '16px' }}>Split bills equally</p>
                                        <input type="number" className="payment-input" placeholder="Total Amount" />
                                        <button className="btn btn-primary" style={{ width: '100%', marginTop: '12px' }}>
                                            Split with {group.members} members
                                        </button>
                                    </div>
                                    <div className="payment-card">
                                        <h3><i className="fas fa-link"></i> Avail - Cross-Chain Pool</h3>
                                        <p style={{ fontSize: '14px', marginBottom: '16px' }}>Unified group treasury</p>
                                        <div style={{ padding: '16px', background: 'rgba(10, 14, 26, 0.8)', borderRadius: '10px', marginTop: '12px', textAlign: 'center' }}>
                                            <div style={{ fontSize: '24px', fontWeight: 700 }}>$0 USDC</div>
                                            <div style={{ fontSize: '12px', marginTop: '4px' }}>Group Pool Balance</div>
                                        </div>
                                        <button className="btn btn-secondary" style={{ width: '100%', marginTop: '12px' }}>
                                            Add to Pool
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // WebGL Circular Gallery Component with Full Implementation
        function CircularGallery({ items, onItemClick }) {
            const containerRef = useRef(null);
            const appRef = useRef(null);
            const [isReady, setIsReady] = useState(false);

            useEffect(() => {
                // Wait for OGL and CircularGalleryApp to be loaded
                const checkReady = () => {
                    if (window.OGL && window.CircularGalleryApp && window.OGLReady) {
                        setIsReady(true);
                        console.log('✅ All dependencies ready for gallery');
                    } else {
                        setTimeout(checkReady, 100);
                    }
                };
                checkReady();
            }, []);

            useEffect(() => {
                if (!isReady || !containerRef.current) return;
                
                // Double-check dependencies are loaded
                if (!window.OGL || !window.CircularGalleryApp) {
                    console.error('Dependencies not loaded:', {
                        OGL: !!window.OGL,
                        CircularGalleryApp: !!window.CircularGalleryApp
                    });
                    return;
                }

                const galleryItems = items.map((group) => ({
                    image: group.image,
                    text: group.name,
                    id: group.id
                }));

                // Initialize the circular gallery
                try {
                    appRef.current = new window.CircularGalleryApp(containerRef.current, {
                        items: galleryItems,
                        bend: 3,
                        textColor: '#ffffff',
                        borderRadius: 0.05,
                        scrollSpeed: 2,
                        scrollEase: 0.05,
                        onItemClick: (index) => {
                            if (onItemClick && items[index]) {
                                onItemClick(items[index]);
                            }
                        }
                    });
                    console.log('Circular gallery initialized successfully!');
                } catch (error) {
                    console.error('Failed to initialize circular gallery:', error);
                }
                
                return () => {
                    if (appRef.current && appRef.current.destroy) {
                        appRef.current.destroy();
                    }
                };
            }, [isReady, items, onItemClick]);

            return (
                <div className="circular-gallery" ref={containerRef}>
                    {!isReady && (
                        <div style={{ 
                            display: 'flex', 
                            alignItems: 'center', 
                            justifyContent: 'center',
                            height: '100%',
                            color: 'var(--text-secondary)'
                        }}>
                            <div className="loading">Loading gallery...</div>
                        </div>
                    )}
                </div>
            );
        }

        function App() {
            const [currentPage, setCurrentPage] = useState('home');
            const [selectedGroup, setSelectedGroup] = useState(null);
            const [groups, setGroups] = useState(() => {
                // Load groups from localStorage or use default
                const saved = localStorage.getItem('orbitGroups');
                return saved ? JSON.parse(saved) : window.AppData?.groups || [];
            });

            // Save groups to localStorage whenever they change
            useEffect(() => {
                localStorage.setItem('orbitGroups', JSON.stringify(groups));
            }, [groups]);

            // Navigation handlers
            const navigate = (page) => {
                setCurrentPage(page);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleGroupClick = (group) => {
                setSelectedGroup(group);
                navigate('group-detail');
            };

            const handleCreateGroup = (formData) => {
                const newGroup = {
                    id: Date.now(),
                    name: formData.name,
                    icon: formData.icon,
                    members: 1,
                    color: formData.color,
                    image: formData.image || window.AppData.sampleImages[Math.floor(Math.random() * window.AppData.sampleImages.length)],
                    description: formData.description || `A new group for ${formData.name}`,
                    walletAddress: window.AppData.generateWalletAddress(),
                    created: new Date().toISOString().split('T')[0],
                    totalExpenses: 0
                };

                setGroups([...groups, newGroup]);
                navigate('groups');
            };

            // Render based on current page
            return (
                <div className="app-container" style={{
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #0f172a 0%, #1e293b 100%)'
                }}>
                    {/* Header Navigation */}
                    {currentPage !== 'home' && (
                        <div className="header" style={{
                            position: 'sticky',
                            top: 0,
                            zIndex: 1000,
                            animation: 'slideDown 0.6s cubic-bezier(0.16, 1, 0.3, 1)'
                        }}>
                            <div onClick={() => navigate('home')} style={{ cursor: 'pointer' }}>
                                <div className="logo">
                                    <i className="fas fa-circle-notch"></i>
                                    Orbit
                                </div>
                                <div className="tagline">Your world, perfectly organized</div>
                            </div>
                            <div className="nav-buttons">
                                <button 
                                    className={`btn ${currentPage === 'groups' ? 'btn-primary' : 'btn-secondary'}`}
                                    onClick={() => navigate('groups')}
                                >
                                    <i className="fas fa-globe"></i> Groups
                                </button>
                                <button 
                                    className={`btn ${currentPage === 'create' ? 'btn-primary' : 'btn-secondary'}`}
                                    onClick={() => navigate('create')}
                                >
                                    <i className="fas fa-plus"></i> Create
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Page Routing */}
                    {currentPage === 'home' && (
                        <HomePage 
                            onNavigate={navigate}
                            userData={{ groups }}
                        />
                    )}
                    
                    {currentPage === 'groups' && (
                        <GroupsPage 
                            groups={groups}
                            onGroupClick={handleGroupClick}
                            onCreateClick={() => navigate('create')}
                        />
                    )}
                    
                    {currentPage === 'create' && (
                        <CreateGroupPage 
                            onCreate={handleCreateGroup}
                            onCancel={() => navigate('groups')}
                        />
                    )}
                    
                    {currentPage === 'group-detail' && (
                        <GroupDetailPage 
                            group={selectedGroup}
                            circles={dataCircles}
                            posts={dataPosts}
                            onBack={() => navigate('groups')}
                        />
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
